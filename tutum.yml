mqAuth:
  image: cloudintellij/mq-auth
  target_num_containers: 2
  deployment_strategy: high_availability
  autorestart: on_failure
  tags:
    - flux
  environment:
    _JAVA_OPTIONS: "-Xms48m -Xmx64M"
    MANAGEMENT_USER: admin
# https://support.tutum.co/support/tickets/1287 we cannot use one certs service for mq and web (see Implementation.md)
certs-mq:
  image: tutum.co/develar/intellij-io-certs
  deployment_strategy: every_node
  tags:
    - flux
    - mq
certs-web:
  image: tutum.co/develar/intellij-io-certs
  deployment_strategy: every_node
  tags:
    - flux
    - web
mq:
  image: develar/rabbitmq-auth
  autorestart: on_failure
  tags:
    - flux
    - mq
  links:
    - mqAuth:mq-auth
  volumes_from:
    - certs-mq
  ports:
    - "80:5671"
    # web stomp
    - "443:4443"
    # management
    - "15672:15672"
web:
  image: cloudintellij/flux-web
  autorestart: on_failure
  tags:
    - flux
    - web
  volumes_from:
    - certs-web
  ports:
    - 80:80
    - 443:443
oauth-shim:
  image: develar/oauth-shim
  autorestart: on_failure
  tags:
    - flux
    - web
  ports:
    - 3000:80