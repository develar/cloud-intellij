var hello=function(name){return hello.use(name)};hello.utils={extend:function(r){for(var args=Array.prototype.slice.call(arguments,1),i=0;i<args.length;i++){var a=args[i];if(r instanceof Object&&a instanceof Object&&r!==a)for(var x in a)r[x]=hello.utils.extend(r[x],a[x]);else r=a}return r}},hello.utils.extend(hello,{settings:{redirect_uri:window.location.href.split("#")[0],response_type:"token",display:"popup",state:"",oauth_proxy:"https://auth-server.herokuapp.com/proxy",timeout:2e4,default_service:null,force:!0,page_uri:window.location.href},service:function(service){return"undefined"!=typeof service?this.utils.store("sync_service",service):this.utils.store("sync_service")},services:{},use:function(service){var self=Object.create(this);return self.settings=Object.create(this.settings),service&&(self.settings.default_service=service),self.utils.Event.call(self),self},init:function(services,options){var utils=this.utils;if(!services)return this.services;for(var x in services)services.hasOwnProperty(x)&&"object"!=typeof services[x]&&(services[x]={id:services[x]});utils.extend(this.services,services);for(x in this.services)this.services.hasOwnProperty(x)&&(this.services[x].scope=this.services[x].scope||{});return options&&(utils.extend(this.settings,options),"redirect_uri"in options&&(this.settings.redirect_uri=utils.url(options.redirect_uri).href)),this},login:function(){function emit(s,value){hello.emit(s,value)}function error(code,message){return{error:{code:code,message:message}}}function encodeFunction(s){return s}var url,_this=this,utils=_this.utils,promise=utils.Promise(),p=utils.args({network:"s",options:"o",callback:"f"},arguments),opts=p.options=utils.merge(_this.settings,p.options||{});if(p.network=p.network||_this.settings.default_service,promise.proxy.then(p.callback,p.callback),promise.proxy.then(emit.bind(this,"auth.login auth"),emit.bind(this,"auth.failed auth")),"string"!=typeof p.network||!(p.network in _this.services))return promise.reject(error("invalid_network","The provided network was not recognized"));var provider=_this.services[p.network],callbackId=utils.globalEvent(function(str){var obj;obj=str?JSON.parse(str):error("cancelled","The authentication was not completed"),obj.error?promise.reject(obj):(utils.store(obj.network,obj),promise.fulfill({network:obj.network,authResponse:obj}))}),redirectUri=utils.url(opts.redirect_uri).href,responseType=provider.oauth.response_type||opts.response_type;/\bcode\b/.test(responseType)&&!provider.oauth.grant&&(responseType=responseType.replace(/\bcode\b/,"token")),p.qs={client_id:encodeURIComponent(provider.id),response_type:encodeURIComponent(responseType),redirect_uri:encodeURIComponent(redirectUri),display:opts.display,scope:"basic",state:{client_id:provider.id,network:p.network,display:opts.display,callback:callbackId,state:opts.state,redirect_uri:redirectUri}};var session=utils.store(p.network),scope=(opts.scope||"").toString();scope=(scope?scope+",":"")+p.qs.scope,session&&"scope"in session&&"string"==typeof session.scope&&(scope+=","+session.scope);var pQsStateScopeArray=utils.unique(scope.split(/[,\s]+/));if(p.qs.state.scope=pQsStateScopeArray.join(","),p.qs.scope=scope.replace(/[^,\s]+/gi,function(m){if(m in provider.scope)return provider.scope[m];for(var x in _this.services){var serviceScopes=_this.services[x].scope;if(serviceScopes&&m in serviceScopes)return""}return m}).replace(/[,\s]+/gi,","),p.qs.scope=utils.unique(p.qs.scope.split(/,+/)).join(provider.scope_delim||","),opts.force===!1&&session&&"access_token"in session&&session.access_token&&"expires"in session&&session.expires>(new Date).getTime()/1e3){var diff=utils.diff(session.scope||[],pQsStateScopeArray);if(0===diff.length)return promise.fulfill({unchanged:!0,network:p.network,authResponse:session}),promise}if("page"===opts.display&&opts.page_uri&&(p.qs.state.page_uri=utils.url(opts.page_uri).href),"login"in provider&&"function"==typeof provider.login&&provider.login(p),(!/\btoken\b/.test(responseType)||parseInt(provider.oauth.version,10)<2||"none"===opts.display&&provider.oauth.grant&&session&&session.refresh_token)&&(p.qs.state.oauth=provider.oauth,p.qs.state.oauth_proxy=opts.oauth_proxy),p.qs.state=encodeURIComponent(JSON.stringify(p.qs.state)),1===parseInt(provider.oauth.version,10)?url=utils.qs(opts.oauth_proxy,p.qs,encodeFunction):"none"===opts.display&&provider.oauth.grant&&session&&session.refresh_token?(p.qs.refresh_token=session.refresh_token,url=utils.qs(opts.oauth_proxy,p.qs,encodeFunction)):url=utils.qs(provider.oauth.auth,p.qs,encodeFunction),"none"===opts.display)utils.iframe(url);else if("popup"===opts.display)var popup=utils.popup(url,redirectUri,opts.window_width||500,opts.window_height||550),timer=setInterval(function(){if((!popup||popup.closed)&&(clearInterval(timer),!promise.state)){var response=error("cancelled","Login has been cancelled");popup||(response=error("blocked","Popup was blocked")),response.network=p.network,promise.reject(response)}},100);else window.location=url;return promise.proxy},logout:function(){function emit(s,value){hello.emit(s,value)}function error(code,message){return{error:{code:code,message:message}}}var _this=this,utils=_this.utils,promise=utils.Promise(),p=utils.args({name:"s",options:"o",callback:"f"},arguments);if(p.options=p.options||{},promise.proxy.then(p.callback,p.callback),promise.proxy.then(emit.bind(this,"auth.logout auth"),emit.bind(this,"error")),p.name=p.name||this.settings.default_service,!p.name||p.name in _this.services)if(p.name&&utils.store(p.name)){var callback=function(opts){utils.store(p.name,""),promise.fulfill(hello.utils.merge({network:p.name},opts||{}))},_opts={};if(p.options.force){var logout=_this.services[p.name].logout;if(logout)if("function"==typeof logout&&(logout=logout(callback)),"string"==typeof logout)utils.iframe(logout),_opts.force=null,_opts.message="Logout success on providers site was indeterminate";else if(void 0===logout)return promise.proxy}callback(_opts)}else promise.reject(error("invalid_session","There was no session to remove"));else promise.reject(error("invalid_network","The network was unrecognized"));return promise.proxy},getAuthResponse:function(service){return service=service||this.settings.default_service,service&&service in this.services?this.utils.store(service)||null:null},events:{}}),hello.utils.extend(hello.utils,{qs:function(url,params,formatFunction){if(params){var reg;for(var x in params)if(url.indexOf(x)>-1){var str="[\\?\\&]"+x+"=[^\\&]*";reg=new RegExp(str),url=url.replace(reg,"")}}return url+(this.isEmpty(params)?"":(url.indexOf("?")>-1?"&":"?")+this.param(params,formatFunction))},param:function(s,formatFunction){var b,m,a={};if("string"==typeof s){if(formatFunction=formatFunction||decodeURIComponent,m=s.replace(/^[\#\?]/,"").match(/([^=\/\&]+)=([^\&]+)/g))for(var i=0;i<m.length;i++)b=m[i].match(/([^=]+)=(.*)/),a[b[1]]=formatFunction(b[2]);return a}formatFunction=formatFunction||encodeURIComponent;var o=s;a=[];for(var x in o)o.hasOwnProperty(x)&&o.hasOwnProperty(x)&&a.push([x,"?"===o[x]?"?":formatFunction(o[x])].join("="));return a.join("&")},store:function(localStorage){function get(){var json={};try{json=JSON.parse(localStorage.getItem("hello"))||{}}catch(e){}return json}function set(json){localStorage.setItem("hello",JSON.stringify(json))}var a=[localStorage,window.sessionStorage],i=0;for(localStorage=a[i++];localStorage;)try{localStorage.setItem(i,i),localStorage.removeItem(i);break}catch(e){localStorage=a[i++]}return localStorage||(localStorage={getItem:function(prop){prop+="=";for(var m=document.cookie.split(";"),i=0;i<m.length;i++){var _m=m[i].replace(/(^\s+|\s+$)/,"");if(_m&&0===_m.indexOf(prop))return _m.substr(prop.length)}return null},setItem:function(prop,value){document.cookie=prop+"="+value}}),function(name,value,days){var json=get();if(name&&void 0===value)return json[name]||null;if(name&&null===value)try{delete json[name]}catch(e){json[name]=null}else{if(!name)return json;json[name]=value}return set(json),json||null}}(window.localStorage),append:function(node,attr,target){var n="string"==typeof node?document.createElement(node):node;if("object"==typeof attr)if("tagName"in attr)target=attr;else for(var x in attr)if(attr.hasOwnProperty(x))if("object"==typeof attr[x])for(var y in attr[x])attr[x].hasOwnProperty(y)&&(n[x][y]=attr[x][y]);else"html"===x?n.innerHTML=attr[x]:/^on/.test(x)?n[x]=attr[x]:n.setAttribute(x,attr[x]);return"body"===target?!function self(){document.body?document.body.appendChild(n):setTimeout(self,16)}():"object"==typeof target?target.appendChild(n):"string"==typeof target&&document.getElementsByTagName(target)[0].appendChild(n),n},iframe:function(src){this.append("iframe",{src:src,style:{position:"absolute",left:"-1000px",bottom:0,height:"1px",width:"1px"}},"body")},merge:function(){var args=Array.prototype.slice.call(arguments);return args.unshift({}),this.extend.apply(null,args)},args:function(o,args){var p={},i=0,t=null,x=null;for(x in o)if(o.hasOwnProperty(x))break;if(1===args.length&&"object"==typeof args[0]&&"o!"!=o[x])for(x in args[0])if(o.hasOwnProperty(x)&&x in o)return args[0];for(x in o)if(o.hasOwnProperty(x))if(t=typeof args[i],"function"==typeof o[x]&&o[x].test(args[i])||"string"==typeof o[x]&&(o[x].indexOf("s")>-1&&"string"===t||o[x].indexOf("o")>-1&&"object"===t||o[x].indexOf("i")>-1&&"number"===t||o[x].indexOf("a")>-1&&"object"===t||o[x].indexOf("f")>-1&&"function"===t))p[x]=args[i++];else if("string"==typeof o[x]&&o[x].indexOf("!")>-1)return!1;return p},url:function(path){if(path){if(window.URL&&URL instanceof Function&&0!==URL.length)return new URL(path,window.location);var a=document.createElement("a");return a.href=path,a}return window.location},diff:function(a,b){return b.filter(function(item){return-1===a.indexOf(item)})},unique:function(a){return Array.isArray(a)?a.filter(function(item,index){return a.indexOf(item)===index}):[]},isEmpty:function(obj){if(!obj)return!0;if(Array.isArray(obj))return!obj.length;if("object"==typeof obj)for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0},Promise:function(){var STATE_PENDING=0,STATE_FULFILLED=1,STATE_REJECTED=2,api=function(executor){return this instanceof api?(this.id="Thenable/1.0.6",this.state=STATE_PENDING,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},void("function"==typeof executor&&executor.call(this,this.fulfill.bind(this),this.reject.bind(this)))):new api(executor)};api.prototype={fulfill:function(value){return deliver(this,STATE_FULFILLED,"fulfillValue",value)},reject:function(value){return deliver(this,STATE_REJECTED,"rejectReason",value)},then:function(onFulfilled,onRejected){var curr=this,next=new api;return curr.onFulfilled.push(resolver(onFulfilled,next,"fulfill")),curr.onRejected.push(resolver(onRejected,next,"reject")),execute(curr),next.proxy}};var deliver=function(curr,state,name,value){return curr.state===STATE_PENDING&&(curr.state=state,curr[name]=value,execute(curr)),curr},execute=function(curr){curr.state===STATE_FULFILLED?execute_handlers(curr,"onFulfilled",curr.fulfillValue):curr.state===STATE_REJECTED&&execute_handlers(curr,"onRejected",curr.rejectReason)},execute_handlers=function(curr,name,value){if(0!==curr[name].length){var handlers=curr[name];curr[name]=[];var func=function(){for(var i=0;i<handlers.length;i++)handlers[i](value)};"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick(func):"function"==typeof setImmediate?setImmediate(func):setTimeout(func,0)}},resolver=function(cb,next,method){return function(value){if("function"!=typeof cb)next[method].call(next,value);else{var result;try{result=cb(value)}catch(e){return void next.reject(e)}resolve(next,result)}}},resolve=function(promise,x){if(promise===x||promise.proxy===x)return void promise.reject(new TypeError("cannot resolve promise with itself"));var then;if("object"==typeof x&&null!==x||"function"==typeof x)try{then=x.then}catch(e){return void promise.reject(e)}if("function"!=typeof then)promise.fulfill(x);else{var resolved=!1;try{then.call(x,function(y){resolved||(resolved=!0,y===x?promise.reject(new TypeError("circular thenable chain")):resolve(promise,y))},function(r){resolved||(resolved=!0,promise.reject(r))})}catch(e){resolved||promise.reject(e)}}};return api}(),Event:function(){var separator=/[\s\,]+/;return this.parent={events:this.events,findEvents:this.findEvents,parent:this.parent,utils:this.utils},this.events={},this.on=function(evt,callback){if(callback&&"function"==typeof callback)for(var a=evt.split(separator),i=0;i<a.length;i++)this.events[a[i]]=[callback].concat(this.events[a[i]]||[]);return this},this.off=function(evt,callback){return this.findEvents(evt,function(name,index){callback&&this.events[name][index]!==callback||(this.events[name][index]=null)}),this},this.emit=function(evt){var args=Array.prototype.slice.call(arguments,1);args.push(evt);for(var handler=function(name,index){args[args.length-1]="*"===name?evt:name,this.events[name][index].apply(this,args)},_this=this;_this&&_this.findEvents;)_this.findEvents(evt+",*",handler),_this=_this.parent;return this},this.emitAfter=function(){var _this=this,args=arguments;return setTimeout(function(){_this.emit.apply(_this,args)},0),this},this.findEvents=function(evt,callback){var a=evt.split(separator);for(var name in this.events)if(this.events.hasOwnProperty(name)&&a.indexOf(name)>-1)for(var i=0;i<this.events[name].length;i++)this.events[name][i]&&callback.call(this,name,i)},this},globalEvent:function(callback,guid){return guid=guid||"_hellojs_"+parseInt(1e12*Math.random(),10).toString(36),window[guid]=function(){try{bool=callback.apply(this,arguments)}catch(e){console.error(e)}if(bool)try{delete window[guid]}catch(e){}},guid},popup:function(url,redirectUri,windowWidth,windowHeight){var documentElement=document.documentElement,dualScreenLeft=void 0!==window.screenLeft?window.screenLeft:screen.left,dualScreenTop=void 0!==window.screenTop?window.screenTop:screen.top,width=window.innerWidth||documentElement.clientWidth||screen.width,height=window.innerHeight||documentElement.clientHeight||screen.height,left=(width-windowWidth)/2+dualScreenLeft,top=(height-windowHeight)/2+dualScreenTop,open=function(url){var popup=window.open(url,"_blank","resizeable=true,height="+windowHeight+",width="+windowWidth+",left="+left+",top="+top);if(popup&&popup.addEventListener){var a=hello.utils.url(redirectUri),redirectUriOrigin=a.origin||a.protocol+"//"+a.hostname;popup.addEventListener("loadstart",function(e){var url=e.url;if(0===url.indexOf(redirectUriOrigin)){var a=hello.utils.url(url),_popup={location:{assign:function(location){popup.addEventListener("exit",function(){setTimeout(function(){open(location)},1e3)})},search:a.search,hash:a.hash,href:a.href},close:function(){popup.close&&popup.close()}};hello.utils.responseHandler(_popup,window),_popup.close()}})}return popup&&popup.focus&&popup.focus(),popup};return-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")&&(url=redirectUri+"#oauth_redirect="+encodeURIComponent(encodeURIComponent(url))),open(url)},responseHandler:function(window,parent){function authCallback(obj,window,parent){if(_this.store(obj.network,obj),!("display"in obj&&"page"===obj.display)){if(parent){var cb=obj.callback;try{delete obj.callback}catch(e){}if(_this.store(obj.network,obj),cb in parent){var str=JSON.stringify(obj);try{parent[cb](str)}catch(e){}}}closeWindow()}}function closeWindow(){try{window.close()}catch(e){}window.addEventListener&&window.addEventListener("load",function(){window.close()})}var p,_this=this,location=window.location;if(p=_this.param(location.search),p&&(p.code&&p.state||p.oauth_token&&p.proxy_url)){var state=JSON.parse(p.state);p.redirect_uri=state.redirect_uri||location.href.replace(/[\?\#].*$/,"");var path=(state.oauth_proxy||p.proxy_url)+"?"+_this.param(p);return void location.assign(path)}if(p=_this.merge(_this.param(location.search||""),_this.param(location.hash||"")),p&&"state"in p){try{var a=JSON.parse(p.state);_this.extend(p,a)}catch(e){console.error("Could not decode state parameter")}if("access_token"in p&&p.access_token&&p.network)p.expires_in&&0!==parseInt(p.expires_in,10)||(p.expires_in=0),p.expires_in=parseInt(p.expires_in,10),p.expires=(new Date).getTime()/1e3+(p.expires_in||31536e3),authCallback(p,window,parent);else if("error"in p&&p.error&&p.network)p.error={code:p.error,message:p.error_message||p.error_description},authCallback(p,window,parent);else if(p.callback&&p.callback in parent){var res="result"in p&&p.result?JSON.parse(p.result):!1;parent[p.callback](res),closeWindow()}p.page_uri&&location.assign(p.page_uri)}else if("oauth_redirect"in p)return void location.assign(decodeURIComponent(p.oauth_redirect))}}),hello.utils.Event.call(hello),hello.utils.responseHandler(window,window.opener||window.parent),function(hello){var oldSessions={},expired={};hello.on("auth.login, auth.logout",function(auth){auth&&"object"==typeof auth&&auth.network&&(oldSessions[auth.network]=hello.utils.store(auth.network)||{})}),function self(){var CURRENT_TIME=(new Date).getTime()/1e3,emit=function(eventName){hello.emit("auth."+eventName,{network:name,authResponse:session})};for(var name in hello.services)if(hello.services.hasOwnProperty(name)){if(!hello.services[name].id)continue;var session=hello.utils.store(name)||{},provider=hello.services[name],oldSess=oldSessions[name]||{};if(session&&"callback"in session){var cb=session.callback;try{delete session.callback}catch(e){}hello.utils.store(name,session);try{window[cb](session)}catch(e){}}if(session&&"expires"in session&&session.expires<CURRENT_TIME){var refresh=provider.refresh||session.refresh_token;!refresh||name in expired&&!(expired[name]<CURRENT_TIME)?refresh||name in expired||(emit("expired"),expired[name]=!0):(hello.emit("notice",name+" has expired trying to resignin"),hello.login(name,{display:"none",force:!1}),expired[name]=CURRENT_TIME+600);continue}if(oldSess.access_token===session.access_token&&oldSess.expires===session.expires)continue;!session.access_token&&oldSess.access_token?emit("logout"):session.access_token&&!oldSess.access_token?emit("login"):session.expires!==oldSess.expires&&emit("update"),oldSessions[name]=session,name in expired&&delete expired[name]}setTimeout(self,1e3)}()}(hello),hello.api=function(){function getPath(url){url=url.replace(/\@\{([a-z\_\-]+)(\|.+?)?\}/gi,function(m,key,defaults){var val=defaults?defaults.replace(/^\|/,""):"";return key in p.query?(val=p.query[key],delete p.query[key]):defaults||promise.reject(error("missing_attribute","The attribute "+key+" is missing from the request")),val}),url.match(/^https?:\/\//)||(url=o.base+url),p.url=url,utils.request(p,function(r,headers){if(r===!0?r={success:!0}:r||(r={}),"delete"===p.method&&(r=!r||utils.isEmpty(r)?{success:!0}:r),o.wrap&&(p.path in o.wrap||"default"in o.wrap)){var wrap=p.path in o.wrap?p.path:"default",b=((new Date).getTime(),o.wrap[wrap](r,headers,p));b&&(r=b)}r&&"paging"in r&&r.paging.next&&("?"===r.paging.next[0]?r.paging.next=p.path+r.paging.next:r.paging.next+="#"+p.path),!r||"error"in r?promise.reject(r):promise.fulfill(r)})}function error(code,message){return{error:{code:code,message:message}}}var _this=this,utils=_this.utils,promise=utils.Promise(),p=utils.args({path:"s!",query:"o",method:"s",data:"o",timeout:"i",callback:"f"},arguments);p.method=(p.method||"get").toLowerCase(),p.headers=p.headers||{},p.query=p.query||{},("get"===p.method||"delete"===p.method)&&(utils.extend(p.query,p.data),p.data={});var data=p.data=p.data||{};if(promise.then(p.callback,p.callback),!p.path)return promise.reject(error("invalid_path","Missing the path parameter from the request"));p.path=p.path.replace(/^\/+/,"");var a=(p.path.split(/[\/\:]/,2)||[])[0].toLowerCase();if(a in _this.services){p.network=a;var reg=new RegExp("^"+a+":?/?");p.path=p.path.replace(reg,"")}p.network=_this.settings.default_service=p.network||_this.settings.default_service;var o=_this.services[p.network];if(!o)return promise.reject(error("invalid_network","Could not match the service requested: "+p.network));if(p.method in o&&p.path in o[p.method]&&o[p.method][p.path]===!1)return promise.reject(error("invalid_path","The provided path is not available on the selected network"));p.oauth_proxy||(p.oauth_proxy=_this.settings.oauth_proxy),"proxy"in p||(p.proxy=p.oauth_proxy&&o.oauth&&1===parseInt(o.oauth.version,10)),"timeout"in p||(p.timeout=_this.settings.timeout);var session=_this.getAuthResponse(p.network);session&&session.access_token&&(p.query.access_token=session.access_token);var m,url=p.path;p.options=utils.clone(p.query),p.data=utils.clone(data);var actions=o[{"delete":"del"}[p.method]||p.method]||{};if("get"===p.method){var query=url.split(/[\?#]/)[1];query&&(utils.extend(p.query,utils.param(query)),url=url.replace(/\?.*?(#|$)/,"$1"))}return(m=url.match(/#(.+)/,""))?(url=url.split("#")[0],p.path=m[1]):url in actions?(p.path=url,url=actions[url]):"default"in actions&&(url=actions["default"]),p.redirect_uri=_this.settings.redirect_uri,p.oauth=o.oauth,p.xhr=o.xhr,p.jsonp=o.jsonp,p.form=o.form,"function"==typeof url?url(p,getPath):getPath(url),promise.proxy},hello.utils.extend(hello.utils,{request:function(p,callback){function formatUrl(p,callback){var sign;p.oauth&&1===parseInt(p.oauth.version,10)&&(sign=p.query.access_token,delete p.query.access_token,p.proxy=!0),!p.data||"get"!==p.method&&"delete"!==p.method||(_this.extend(p.query,p.data),p.data=null);var path=_this.qs(p.url,p.query);p.proxy&&(path=_this.qs(p.oauth_proxy,{path:path,access_token:sign||"",then:p.proxy_response_type||("get"===p.method.toLowerCase()?"redirect":"proxy"),method:p.method.toLowerCase(),suppress_response_codes:!0})),callback(path)}var _this=this;if(_this.isEmpty(p.data)||"FileList"in window||!_this.hasBinary(p.data)||(p.xhr=!1,p.jsonp=!1),"withCredentials"in new XMLHttpRequest&&(!("xhr"in p)||p.xhr&&("function"!=typeof p.xhr||p.xhr(p,p.query))))return void formatUrl(p,function(url){var x=_this.xhr(p.method,url,p.headers,p.data,callback);x.onprogress=p.onprogress||null,x.upload&&p.onuploadprogress&&(x.upload.onprogress=p.onuploadprogress)});var _query=p.query;if(p.query=_this.clone(p.query),p.callbackID=_this.globalEvent(),p.jsonp!==!1){if(p.query.callback=p.callbackID,"function"==typeof p.jsonp&&p.jsonp(p,p.query),"get"===p.method)return void formatUrl(p,function(url){_this.jsonp(url,callback,p.callbackID,p.timeout)});p.query=_query}if(p.form!==!1){p.query.redirect_uri=p.redirect_uri,p.query.state=JSON.stringify({callback:p.callbackID});var opts;if("function"==typeof p.form&&(opts=p.form(p,p.query)),"post"===p.method&&opts!==!1)return void formatUrl(p,function(url){_this.post(url,p.data,opts,callback,p.callbackID,p.timeout)})}callback({error:{code:"invalid_request",message:"There was no mechanism for handling this request"}})},domInstance:function(type,data){var test="HTML"+(type||"").replace(/^[a-z]/,function(m){return m.toUpperCase()})+"Element";return data?window[test]?data instanceof window[test]:window.Element?data instanceof window.Element&&(!type||data.tagName&&data.tagName.toLowerCase()===type):!(data instanceof Object||data instanceof Array||data instanceof String||data instanceof Number)&&data.tagName&&data.tagName.toLowerCase()===type:!1},clone:function(obj){if(null===obj||"object"!=typeof obj||obj instanceof Date||"nodeName"in obj||this.isBinary(obj))return obj;if(Array.isArray(obj))return obj.map(this.clone);var clone={};for(var x in obj)clone[x]=this.clone(obj[x]);return clone},xhr:function(method,url,headers,data,callback){function headersToJSON(s){for(var m,r={},reg=/([a-z\-]+):\s?(.*);?/gi;m=reg.exec(s);)r[m[1]]=m[2];return r}var r=new XMLHttpRequest,binary=!1;"blob"===method&&(binary=method,method="GET"),method=method.toUpperCase(),r.onload=function(e){var json=r.response;try{json=JSON.parse(r.responseText)}catch(_e){401===r.status&&(json={error:{code:"access_denied",message:r.statusText}})}var headers=headersToJSON(r.getAllResponseHeaders());headers.statusCode=r.status,callback(json||("GET"===method?{error:{code:"empty_response",message:"Could not get resource"}}:{}),headers)},r.onerror=function(e){var json=r.responseText;try{json=JSON.parse(r.responseText)}catch(_e){}callback(json||{error:{code:"access_denied",message:"Could not get resource"}})};var x;if("GET"===method||"DELETE"===method)data=null;else if(!(!data||"string"==typeof data||data instanceof FormData||data instanceof File||data instanceof Blob)){var f=new FormData;for(x in data)data.hasOwnProperty(x)&&(data[x]instanceof HTMLInputElement?"files"in data[x]&&data[x].files.length>0&&f.append(x,data[x].files[0]):data[x]instanceof Blob?f.append(x,data[x],data.name):f.append(x,data[x]));data=f}if(r.open(method,url,!0),binary&&("responseType"in r?r.responseType=binary:r.overrideMimeType("text/plain; charset=x-user-defined")),headers)for(x in headers)r.setRequestHeader(x,headers[x]);return r.send(data),r},jsonp:function(url,callback,callbackID,timeout){var operaFix,_this=this,bool=0,head=document.getElementsByTagName("head")[0],result={error:{message:"server_error",code:"server_error"}},cb=function(){bool++||window.setTimeout(function(){callback(result),head.removeChild(script)},0)};callbackID=_this.globalEvent(function(json){return result=json,!0},callbackID),url=url.replace(new RegExp("=\\?(&|$)"),"="+callbackID+"$1");var script=_this.append("script",{id:callbackID,name:callbackID,src:url,async:!0,onload:cb,onerror:cb,onreadystatechange:function(){/loaded|complete/i.test(this.readyState)&&cb()}});window.navigator.userAgent.toLowerCase().indexOf("opera")>-1&&(operaFix=_this.append("script",{text:"document.getElementById('"+callbackId+"').onerror();"}),script.async=!1),timeout&&window.setTimeout(function(){result={error:{message:"timeout",code:"timeout"}},cb()},timeout),head.appendChild(script),operaFix&&head.appendChild(operaFix)},post:function(url,data,options,callback,callbackID,timeout){var newform,_this=this,doc=document,form=null,reenableAfterSubmit=[],i=0,x=null,bool=0,cb=function(r){bool++||callback(r)};_this.globalEvent(cb,callbackID);var win;try{win=doc.createElement('<iframe name="'+callbackID+'">')}catch(e){win=doc.createElement("iframe")}if(win.name=callbackID,win.id=callbackID,win.style.display="none",options&&options.callbackonload&&(win.onload=function(){cb({response:"posted",message:"Content was posted"})}),timeout&&setTimeout(function(){cb({error:{code:"timeout",message:"The post operation timed out"}})},timeout),doc.body.appendChild(win),_this.domInstance("form",data)){for(form=data.form,i=0;i<form.elements.length;i++)form.elements[i]!==data&&form.elements[i].setAttribute("disabled",!0);data=form}if(_this.domInstance("form",data))for(form=data,i=0;i<form.elements.length;i++)form.elements[i].disabled||"file"!==form.elements[i].type||(form.encoding=form.enctype="multipart/form-data",form.elements[i].setAttribute("name","file"));else{for(x in data)data.hasOwnProperty(x)&&_this.domInstance("input",data[x])&&"file"===data[x].type&&(form=data[x].form,form.encoding=form.enctype="multipart/form-data");form||(form=doc.createElement("form"),doc.body.appendChild(form),newform=form);var input;for(x in data)if(data.hasOwnProperty(x)){var el=_this.domInstance("input",data[x])||_this.domInstance("textArea",data[x])||_this.domInstance("select",data[x]);if(el&&data[x].form===form)el&&data[x].name!==x&&(data[x].setAttribute("name",x),data[x].name=x);else{var inputs=form.elements[x];if(input)for(inputs instanceof NodeList||(inputs=[inputs]),i=0;i<inputs.length;i++)inputs[i].parentNode.removeChild(inputs[i]);input=doc.createElement("input"),input.setAttribute("type","hidden"),input.setAttribute("name",x),input.value=el?data[x].value:_this.domInstance(null,data[x])?data[x].innerHTML||data[x].innerText:data[x],form.appendChild(input)}}for(i=0;i<form.elements.length;i++)input=form.elements[i],input.name in data||input.getAttribute("disabled")===!0||(input.setAttribute("disabled",!0),reenableAfterSubmit.push(input))}form.setAttribute("method","POST"),form.setAttribute("target",callbackID),form.target=callbackID,form.setAttribute("action",url),setTimeout(function(){form.submit(),setTimeout(function(){try{newform&&newform.parentNode.removeChild(newform)}catch(e){try{console.error("HelloJS: could not remove iframe")}catch(ee){}}for(var i=0;i<reenableAfterSubmit.length;i++)reenableAfterSubmit[i]&&(reenableAfterSubmit[i].setAttribute("disabled",!1),reenableAfterSubmit[i].disabled=!1)},0)},100)},hasBinary:function(data){for(var x in data)if(data.hasOwnProperty(x)&&this.isBinary(data[x]))return!0;return!1},isBinary:function(data){return data instanceof Object&&(this.domInstance("input",data)&&"file"===data.type||"FileList"in window&&data instanceof window.FileList||"File"in window&&data instanceof window.File||"Blob"in window&&data instanceof window.Blob)},toBlob:function(dataURI){var reg=/^data\:([^;,]+(\;charset=[^;,]+)?)(\;base64)?,/i,m=dataURI.match(reg);if(!m)return dataURI;for(var binary=atob(dataURI.replace(reg,"")),array=[],i=0;i<binary.length;i++)array.push(binary.charCodeAt(i));return new Blob([new Uint8Array(array)],{type:m[1]})}}),function(hello){var api=hello.api,utils=hello.utils;utils.extend(utils,{dataToJSON:function(p){var _this=this,w=window,data=p.data;if(_this.domInstance("form",data)?data=_this.nodeListToJSON(data.elements):"NodeList"in w&&data instanceof NodeList?data=_this.nodeListToJSON(data):_this.domInstance("input",data)&&(data=_this.nodeListToJSON([data])),("File"in w&&data instanceof w.File||"Blob"in w&&data instanceof w.Blob||"FileList"in w&&data instanceof w.FileList)&&(data={file:data}),!("FormData"in w&&data instanceof w.FormData))for(var x in data)if(data.hasOwnProperty(x))if("FileList"in w&&data[x]instanceof w.FileList)1===data[x].length&&(data[x]=data[x][0]);else{if(_this.domInstance("input",data[x])&&"file"===data[x].type)continue;_this.domInstance("input",data[x])||_this.domInstance("select",data[x])||_this.domInstance("textArea",data[x])?data[x]=data[x].value:_this.domInstance(null,data[x])&&(data[x]=data[x].innerHTML||data[x].innerText)}return p.data=data,data},nodeListToJSON:function(nodelist){for(var json={},i=0;i<nodelist.length;i++){var input=nodelist[i];!input.disabled&&input.name&&(json[input.name]="file"===input.type?input:input.value||input.innerHTML)}return json}}),hello.api=function(){var p=utils.args({path:"s!",method:"s",data:"o",timeout:"i",callback:"f"},arguments);return p.data&&utils.dataToJSON(p),api.call(this,p)}}(hello),function(hello){function formatUser(o){return o.id&&(o.thumbnail=o.picture="https://graph.facebook.com/"+o.id+"/picture"),o}function formatFriends(o){return"data"in o&&o.data.forEach(formatUser),o}function format(o,headers,req){if("boolean"==typeof o&&(o={success:o}),o&&"data"in o){var token=req.query.access_token;o.data.forEach(function(d){d.picture&&(d.thumbnail=d.picture),d.cover_photo&&(d.thumbnail=base+d.cover_photo+"/picture?access_token="+token),"album"===d.type&&(d.files=d.photos=base+d.id+"/photos"),d.can_upload&&(d.upload_location=base+d.id+"/photos")})}return o}hello.init({facebook:{name:"Facebook",oauth:{version:2,auth:"https://www.facebook.com/dialog/oauth/",grant:"https://graph.facebook.com/oauth/access_token"},scope:{basic:"public_profile",email:"email",birthday:"user_birthday",events:"user_events",photos:"user_photos,user_videos",videos:"user_photos,user_videos",friends:"user_friends",files:"user_photos,user_videos",publish_files:"user_photos,user_videos,publish_actions",publish:"publish_actions",offline_access:"offline_access"},refresh:!0,login:function(p){p.options.auth_type&&(p.qs.auth_type=p.options.auth_type),p.options.window_width=580,p.options.window_height=400},logout:function(callback){var callbackID=hello.utils.globalEvent(callback),redirect=encodeURIComponent(hello.settings.redirect_uri+"?"+hello.utils.param({callback:callbackID,result:JSON.stringify({
force:!0}),state:"{}"})),token=(hello.utils.store("facebook")||{}).access_token;return hello.utils.iframe("https://www.facebook.com/logout.php?next="+redirect+"&access_token="+token),token?void 0:!1},base:"https://graph.facebook.com/",get:{me:"me","me/friends":"me/friends","me/following":"me/friends","me/followers":"me/friends","me/share":"me/feed","me/like":"me/likes","me/files":"me/albums","me/albums":"me/albums","me/album":"@{id}/photos","me/photos":"me/photos","me/photo":"@{id}","friend/albums":"@{id}/albums","friend/photos":"@{id}/photos"},post:{"me/share":"me/feed","me/photo":"@{id}"},wrap:{me:formatUser,"me/friends":formatFriends,"me/following":formatFriends,"me/followers":formatFriends,"me/albums":format,"me/files":format,"default":format},xhr:function(p,qs){return("get"===p.method||"post"===p.method)&&(qs.suppress_response_codes=!0),"post"===p.method&&p.data&&"string"==typeof p.data.file&&(p.data.file=hello.utils.toBlob(p.data.file)),!0},jsonp:function(p,qs){var m=p.method;"get"===m||hello.utils.hasBinary(p.data)?"delete"===p.method&&(qs.method="delete",p.method="post"):(p.data.method=m,p.method="get")},form:function(p){return{callbackonload:!0}}}});var base="https://graph.facebook.com/"}(hello),function(hello){function formatError(o,headers){var code=headers?headers.statusCode:o&&"meta"in o&&"status"in o.meta&&o.meta.status;(401===code||403===code)&&(o.error={code:"access_denied",message:o.message||(o.data?o.data.message:"Could not get response")},delete o.message)}function formatUser(o){o.id&&(o.thumbnail=o.picture=o.avatar_url,o.name=o.login)}function paging(res,headers,req){if(res.data&&res.data.length&&headers&&headers.Link){var next=headers.Link.match(/<(.*?)>;\s*rel=\"next\"/);next&&(res.paging={next:next[1]})}}hello.init({github:{name:"GitHub",oauth:{version:2,auth:"https://github.com/login/oauth/authorize",grant:"https://github.com/login/oauth/access_token",response_type:"code"},scope:{basic:"",email:"user:email"},base:"https://api.github.com/",get:{me:"user","me/friends":"user/following?per_page=@{limit|100}","me/following":"user/following?per_page=@{limit|100}","me/followers":"user/followers?per_page=@{limit|100}","me/like":"user/starred?per_page=@{limit|100}"},wrap:{me:function(o,headers){return formatError(o,headers),formatUser(o),o},"default":function(o,headers,req){return formatError(o,headers),Array.isArray(o)&&(o={data:o}),o.data&&(paging(o,headers,req),o.data.forEach(formatUser)),o}},xhr:function(p){return"get"!==p.method&&p.data&&(p.headers=p.headers||{},p.headers["Content-Type"]="application/json","object"==typeof p.data&&(p.data=JSON.stringify(p.data))),!0}}})}(hello),function(hello){function toInt(s){return parseInt(s,10)}function formatFeed(o){return paging(o),o.data=o.items,delete o.items,o}function formatItem(o){return o.error?void 0:(o.name||(o.name=o.title||o.message),o.picture||(o.picture=o.thumbnailLink),o.thumbnail||(o.thumbnail=o.thumbnailLink),"application/vnd.google-apps.folder"===o.mimeType&&(o.type="folder",o.files="https://www.googleapis.com/drive/v2/files?q=%22"+o.id+"%22+in+parents"),o)}function formatImage(item){return{source:item.url,width:item.width,height:item.height}}function gEntry(o){if(paging(o),"feed"in o&&"entry"in o.feed)o.data=o.feed.entry.map(formatEntry),delete o.feed;else{if("entry"in o)return formatEntry(o.entry);"items"in o?(o.data=o.items.map(formatItem),delete o.items):formatItem(o)}return o}function formatPerson(o){o.name=o.displayName||o.name,o.picture=o.picture||(o.image?o.image.url:null),o.thumbnail=o.picture}function formatFriends(o,headers,req){paging(o);if("feed"in o&&"entry"in o.feed){for(var token=req.query.access_token,i=0;i<o.feed.entry.length;i++){var a=o.feed.entry[i];if(a.id=a.id.$t,a.name=a.title.$t,delete a.title,a.gd$email&&(a.email=a.gd$email&&a.gd$email.length>0?a.gd$email[0].address:null,a.emails=a.gd$email,delete a.gd$email),a.updated&&(a.updated=a.updated.$t),a.link){var pic=a.link.length>0?a.link[0].href+"?access_token="+token:null;pic&&(a.picture=pic,a.thumbnail=pic),delete a.link}a.category&&delete a.category}o.data=o.feed.entry,delete o.feed}return o}function formatEntry(a){var _a,group=a.media$group,media=group.media$content.length?group.media$content[0]:{},i=0,p={id:a.id.$t,name:a.title.$t,description:a.summary.$t,updated_time:a.updated.$t,created_time:a.published.$t,picture:media?media.url:null,images:[],thumbnail:media?media.url:null,width:media.width,height:media.height};if("link"in a)for(i=0;i<a.link.length;i++){var d=a.link[i];if(d.rel.match(/\#feed$/)){p.upload_location=p.files=p.photos=d.href;break}}if("category"in a&&a.category.length)for(_a=a.category,i=0;i<_a.length;i++)_a[i].scheme&&_a[i].scheme.match(/\#kind$/)&&(p.type=_a[i].term.replace(/^.*?\#/,""));return"media$thumbnail"in group&&group.media$thumbnail.length&&(_a=group.media$thumbnail,p.thumbnail=_a[0].url,p.images=_a.map(formatImage)),_a=group.media$content,_a&&_a.length&&p.images.push(formatImage(_a[0])),p}function paging(res){if("feed"in res&&res.feed.openSearch$itemsPerPage){var limit=toInt(res.feed.openSearch$itemsPerPage.$t),start=toInt(res.feed.openSearch$startIndex.$t),total=toInt(res.feed.openSearch$totalResults.$t);total>start+limit&&(res.paging={next:"?start="+(start+limit)})}else"nextPageToken"in res&&(res.paging={next:"?pageToken="+res.nextPageToken})}function Multipart(){function addFile(item){var fr=new FileReader;fr.onload=function(e){addContent(btoa(e.target.result),item.type+lineBreak+"Content-Transfer-Encoding: base64")},fr.readAsBinaryString(item)}function addContent(content,type){body.push(lineBreak+"Content-Type: "+type+lineBreak+lineBreak+content),counter--,ready()}var body=[],boundary=(1e10*Math.random()).toString(32),counter=0,lineBreak="\r\n",delim=lineBreak+"--"+boundary,ready=function(){},dataUri=/^data\:([^;,]+(\;charset=[^;,]+)?)(\;base64)?,/i;this.append=function(content,type){"string"!=typeof content&&"length"in Object(content)||(content=[content]);for(var i=0;i<content.length;i++){counter++;var item=content[i];if("undefined"!=typeof File&&item instanceof File||"undefined"!=typeof Blob&&item instanceof Blob)addFile(item);else if("string"==typeof item&&item.match(dataUri)){var m=item.match(dataUri);addContent(item.replace(dataUri,""),m[1]+lineBreak+"Content-Transfer-Encoding: base64")}else addContent(item,type)}},this.onready=function(fn){(ready=function(){0===counter&&(body.unshift(""),body.push("--"),fn(body.join(delim),boundary),body=[])})()}}function uploadDrive(p,callback){var data={};p.data&&"undefined"!=typeof HTMLInputElement&&p.data instanceof HTMLInputElement&&(p.data={file:p.data}),!p.data.name&&Object(Object(p.data.file).files).length&&"post"===p.method&&(p.data.name=p.data.file.files[0].name),"post"===p.method?p.data={title:p.data.name,parents:[{id:p.data.parent||"root"}],file:p.data.file}:(data=p.data,p.data={},data.parent&&(p.data.parents=[{id:p.data.parent||"root"}]),data.file&&(p.data.file=data.file),data.name&&(p.data.title=data.name));var file;if("file"in p.data&&(file=p.data.file,delete p.data.file,"object"==typeof file&&"files"in file&&(file=file.files),!file||!file.length))return void callback({error:{code:"request_invalid",message:"There were no files attached with this request to upload"}});var parts=new Multipart;parts.append(JSON.stringify(p.data),"application/json"),file&&parts.append(file),parts.onready(function(body,boundary){p.headers["content-type"]='multipart/related; boundary="'+boundary+'"',p.data=body,callback("upload/drive/v2/files"+(data.id?"/"+data.id:"")+"?uploadType=multipart")})}function toJSON(p){if("object"==typeof p.data)try{p.data=JSON.stringify(p.data),p.headers["content-type"]="application/json"}catch(e){}}var contactsUrl="https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json&max-results=@{limit|1000}&start-index=@{start|1}";hello.init({google:{name:"Google Plus",oauth:{version:2,auth:"https://accounts.google.com/o/oauth2/auth",grant:"https://accounts.google.com/o/oauth2/token"},scope:{basic:"https://www.googleapis.com/auth/plus.me profile",email:"email",birthday:"",events:"",photos:"https://picasaweb.google.com/data/",videos:"http://gdata.youtube.com",friends:"https://www.google.com/m8/feeds, https://www.googleapis.com/auth/plus.login",files:"https://www.googleapis.com/auth/drive.readonly",publish:"",publish_files:"https://www.googleapis.com/auth/drive",create_event:"",offline_access:""},scope_delim:" ",login:function(p){"none"===p.qs.display&&(p.qs.display=""),"code"===p.qs.response_type&&(p.qs.access_type="offline")},base:"https://www.googleapis.com/",get:{me:"plus/v1/people/me","me/friends":"plus/v1/people/me/people/visible?maxResults=@{limit|100}","me/following":contactsUrl,"me/followers":contactsUrl,"me/contacts":contactsUrl,"me/share":"plus/v1/people/me/activities/public?maxResults=@{limit|100}","me/feed":"plus/v1/people/me/activities/public?maxResults=@{limit|100}","me/albums":"https://picasaweb.google.com/data/feed/api/user/default?alt=json&max-results=@{limit|100}&start-index=@{start|1}","me/album":function(p,callback){var key=p.query.id;delete p.query.id,callback(key.replace("/entry/","/feed/"))},"me/photos":"https://picasaweb.google.com/data/feed/api/user/default?alt=json&kind=photo&max-results=@{limit|100}&start-index=@{start|1}","me/files":"drive/v2/files?q=%22@{parent|root}%22+in+parents+and+trashed=false&maxResults=@{limit|100}","me/folders":"drive/v2/files?q=%22@{id|root}%22+in+parents+and+mimeType+=+%22application/vnd.google-apps.folder%22+and+trashed=false&maxResults=@{limit|100}","me/folder":"drive/v2/files?q=%22@{id|root}%22+in+parents+and+trashed=false&maxResults=@{limit|100}"},post:{"me/files":uploadDrive,"me/folders":function(p,callback){p.data={title:p.data.name,parents:[{id:p.data.parent||"root"}],mimeType:"application/vnd.google-apps.folder"},callback("drive/v2/files")}},put:{"me/files":uploadDrive},del:{"me/files":"drive/v2/files/@{id}","me/folder":"drive/v2/files/@{id}"},wrap:{me:function(o){return o.id&&(o.last_name=o.family_name||(o.name?o.name.familyName:null),o.first_name=o.given_name||(o.name?o.name.givenName:null),o.emails&&o.emails.length&&(o.email=o.emails[0].value),formatPerson(o)),o},"me/friends":function(o){return o.items&&(paging(o),o.data=o.items,o.data.forEach(formatPerson),delete o.items),o},"me/contacts":formatFriends,"me/followers":formatFriends,"me/following":formatFriends,"me/share":formatFeed,"me/feed":formatFeed,"me/albums":gEntry,"me/photos":gEntry,"default":gEntry},xhr:function(p){return("post"===p.method||"put"===p.method)&&toJSON(p),!0},form:!1}})}(hello),"function"==typeof define&&define.amd&&define(function(){return hello});
//# sourceMappingURL=hello-1.5.1.js.map